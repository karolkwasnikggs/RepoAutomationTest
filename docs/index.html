<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Release Map</title>
</head>
<body>
  <h1>Release Map: QA â†’ PROD</h1>
  <ul id="map"></ul>

  <script>
    const owner = "karolkwasnikggs";
    const repo = "RepoAutomationTest";
    const branch = "main";

    async function getTxtFiles(folder) {
      const res = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/.releases/${folder}?ref=${branch}`);
      const data = await res.json();
      return data.filter(f => f.name.endsWith(".txt"));
    }

    async function generateMap() {
      const qaFiles = await getTxtFiles("qa");
      const prodFiles = await getTxtFiles("prod");

      const ul = document.getElementById("map");

      for (const prod of prodFiles) {
        const li = document.createElement("li");
        li.innerHTML = `<strong>${prod.name.replace('.txt', '')}</strong><ul></ul>`;
        const inner = li.querySelector("ul");

        const prodDate = prod.name.match(/\d+/)[0]; // np. 20250620

        const matchedQAs = qaFiles.filter(q => q.name.match(/\d+/)[0] <= prodDate);
        for (const qa of matchedQAs) {
          const qaLi = document.createElement("li");
          qaLi.textContent = qa.name.replace('.txt', '');
          inner.appendChild(qaLi);
        }

        ul.appendChild(li);
      }
    }

    generateMap();
  </script>
</body>
</html>
