<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Release Map</title>
  <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <div class="mermaid" id="chart">
    Loading...
  </div>

  <script>
    mermaid.initialize({ startOnLoad: true });

    fetch('../.releases/map.json')
      .then(response => response.json())
      .then(data => {
        let graph = "graph TD\n";
        data.forEach(entry => {
          const id = entry.tag.replace(/[^a-zA-Z0-9]/g, "_");
          graph += `${id}["${entry.tag}\\n${entry.type.toUpperCase()}"]\n`;
          if (entry.type === "prod" && entry.included_qa) {
            entry.included_qa.forEach(qa => {
              const qaId = qa.replace(/[^a-zA-Z0-9]/g, "_");
              graph += `${qaId} --> ${id}\n`;
            });
          }
        });
        document.getElementById("chart").innerText = graph;
        mermaid.contentLoaded();
      });
  </script>
</body>
</html>
